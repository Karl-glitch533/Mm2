-- Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")

-- ScreenGui setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "VanxellHub"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Main Frame for Hub
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 400)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -200)  -- Centered position
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainFrame.BackgroundTransparency = 0.2
MainFrame.BorderSizePixel = 0
MainFrame.Visible = false  -- Set to false initially
MainFrame.Parent = ScreenGui
MainFrame.ClipsDescendants = true
MainFrame.ZIndex = 2  -- Ensure it appears above other UI elements

-- Rounded Corners for MainFrame
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)  -- Rounds the corners
UICorner.Parent = MainFrame

-- Title
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.Text = "Vanxell Hub"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.ZIndex = 2
Title.Parent = MainFrame

-- Rounded Corners for Title
local titleCorner = UICorner:Clone()
titleCorner.Parent = Title

-- GUI Toggle Button positioned on the left side of the screen
local toggleGuiButton = Instance.new("TextButton")
toggleGuiButton.Size = UDim2.new(0, 80, 0, 30)
toggleGuiButton.Position = UDim2.new(0, 10, 0.5, -15)  -- Positioned on the left side
toggleGuiButton.Text = "Toggle GUI"
toggleGuiButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleGuiButton.TextColor3 = Color3.fromRGB(0, 255, 127)
toggleGuiButton.Font = Enum.Font.Gotham
toggleGuiButton.TextSize = 14
toggleGuiButton.Parent = ScreenGui

-- Rounded Corners for Toggle Button
local toggleButtonCorner = UICorner:Clone()
toggleButtonCorner.Parent = toggleGuiButton

-- Toggle Main Frame visibility with fade-in/fade-out effect
toggleGuiButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible  -- Toggle visibility
    local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut)
    local tween = TweenService:Create(MainFrame, tweenInfo, {BackgroundTransparency = MainFrame.Visible and 0.2 or 1})
    tween:Play()
end)

-- Function to create a styled button with hover effect
local function createStyledButton(text, positionY)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, -20, 0, 35)
    button.Position = UDim2.new(0, 10, 0, positionY)
    button.Text = text
    button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.Gotham
    button.TextSize = 16
    button.ZIndex = 2
    button.Parent = MainFrame

    -- Rounded Corners for Buttons
    local buttonCorner = UICorner:Clone()
    buttonCorner.Parent = button

    -- Hover Effect for Buttons
    button.MouseEnter:Connect(function()
        local hoverTween = TweenService:Create(button, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(60, 60, 60)})
        hoverTween:Play()
    end)
    button.MouseLeave:Connect(function()
        local leaveTween = TweenService:Create(button, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(40, 40, 40)})
        leaveTween:Play()
    end)

    return button
end

-- Grab Gun Button
local grabGunButton = createStyledButton("Grab Gun", 50)
grabGunButton.MouseButton1Click:Connect(function()
    local gun = nil
    for _, item in pairs(Workspace:GetDescendants()) do
        if item:IsA("Tool") and item.Name == "Gun" and item.Parent == Workspace then
            gun = item
            break
        end
    end

    if gun then
        LocalPlayer.Character.HumanoidRootPart.CFrame = gun.Handle.CFrame * CFrame.new(0, 2, 0)
        wait(0.1)
        gun.Parent = LocalPlayer.Backpack
        print("Gun grabbed successfully.")
    else
        print("No gun found in the workspace.")
    end
end)

-- Shoot Murder Button
local shootMurderButton = createStyledButton("Shoot Murder", 100)
local smallShootButton = nil  -- Track small button

shootMurderButton.MouseButton1Click:Connect(function()
    -- Create a small button on the right side if it doesnâ€™t exist
    if not smallShootButton then
        smallShootButton = Instance.new("TextButton")
        smallShootButton.Size = UDim2.new(0, 60, 0, 30)
        smallShootButton.Position = UDim2.new(1, -70, 0.5, -15)  -- Positioned on the right side
        smallShootButton.Text = "Shoot"
        smallShootButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        smallShootButton.TextColor3 = Color3.fromRGB(255, 0, 0)
        smallShootButton.Font = Enum.Font.GothamBold
        smallShootButton.TextSize = 14
        smallShootButton.Parent = ScreenGui

        -- Rounded Corners for Small Button
        local smallButtonCorner = UICorner:Clone()
        smallButtonCorner.Parent = smallShootButton

        -- Hover Effect for Small Button
        smallShootButton.MouseEnter:Connect(function()
            local hoverTween = TweenService:Create(smallShootButton, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(60, 0, 0)})
            hoverTween:Play()
        end)
        smallShootButton.MouseLeave:Connect(function()
            local leaveTween = TweenService:Create(smallShootButton, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(30, 30, 30)})
            leaveTween:Play()
        end)

        -- Shoot function for Small Button
        smallShootButton.MouseButton1Click:Connect(function()
            local gun = LocalPlayer.Backpack:FindFirstChild("Gun") or LocalPlayer.Character:FindFirstChild("Gun")
            local shootRemote = ReplicatedStorage:FindFirstChild("ShootRemote")  -- Replace with actual remote event
            if gun and shootRemote then
                print("Shooting at the murderer!")
                shootRemote:FireServer(gun)
            else
                print("You need to grab the gun first or check if remote exists.")
            end
        end)
    end
end)

-- ESP Functionality
local function addEsp(player)
    local highlight = Instance.new("Highlight")
    highlight.Adornee = player.Character or player.CharacterAdded:Wait()
    highlight.FillTransparency = 0.5
    highlight.OutlineTransparency = 0.3
    highlight.Parent = player.Character

    local function updateRole()
        if player.Backpack:FindFirstChild("Knife") or player.Character:FindFirstChild("Knife") then
            highlight.FillColor = Color3.fromRGB(255, 0, 0)  -- Murderer (Red)
        elseif player.Backpack:FindFirstChild("Gun") or player.Character:FindFirstChild("Gun") then
            highlight.FillColor = Color3.fromRGB(0, 0, 255)  -- Sheriff (Blue)
        else
            highlight.FillColor = Color3.fromRGB(0, 255, 0)  -- Innocent (Green)
        end
    end

    player.Backpack.ChildAdded:Connect(updateRole)
    player.Character.DescendantAdded:Connect(updateRole)
    player.CharacterAdded:Connect(function(character)
        highlight.Adornee = character
        updateRole()
    end)

    updateRole()
end

for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        addEsp(player)
    end
end

Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        wait(1)
        addEsp(player)
    end)
end)

game:GetService("ReplicatedStorage").RoundEnded
