-- Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "VanxellHub"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Main Frame for Hub
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 400)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -200)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainFrame.BackgroundTransparency = 0.2
MainFrame.BorderSizePixel = 0
MainFrame.Visible = true -- Set to true for initial testing
MainFrame.Parent = ScreenGui
MainFrame.ClipsDescendants = true

-- Rounded Corners for MainFrame
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = MainFrame

-- Title
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.Text = "Vanxell Hub"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.Parent = MainFrame

-- Function to create styled buttons
local function createStyledButton(text, positionY)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, -20, 0, 35)
    button.Position = UDim2.new(0, 10, 0, positionY)
    button.Text = text
    button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.Gotham
    button.TextSize = 16
    button.Parent = MainFrame

    -- Hover effect
    button.MouseEnter:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    end)
    button.MouseLeave:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    end)

    return button
end

-- Grab Gun Button
local grabGunButton = createStyledButton("Grab Gun", 50)
grabGunButton.MouseButton1Click:Connect(function()
    local gun = workspace:FindFirstChild("Gun") or workspace:FindFirstChild("Weapon") -- Adjust based on the gun's name in your game
    if gun then
        LocalPlayer.Character.HumanoidRootPart.CFrame = gun.Handle.CFrame * CFrame.new(0, 2, 0)
        wait(0.1)
        gun.Parent = LocalPlayer.Backpack
        print("Gun grabbed successfully.")
    else
        print("No gun found.")
    end
end)

-- ESP Functionality
local espEnabled = false
local espBoxes = {}

local function toggleESP()
    espEnabled = not espEnabled
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            if espEnabled then
                local espBox = Instance.new("BoxHandleAdornment")
                espBox.Size = Vector3.new(2, 5, 2)
                espBox.AlwaysOnTop = true
                espBox.ZIndex = 5
                espBox.Parent = player.Character:WaitForChild("HumanoidRootPart")

                -- Set color based on team
                if player.Team and player.Team.Name == "Murderer" then
                    espBox.Color3 = Color3.fromRGB(255, 0, 0) -- Murderer color
                elseif player.Team and player.Team.Name == "Sheriff" then
                    espBox.Color3 = Color3.fromRGB(0, 0, 255) -- Sheriff color
                elseif player.Team and player.Team.Name == "Innocents" then
                    espBox.Color3 = Color3.fromRGB(0, 255, 0) -- Innocent color
                else
                    espBox.Color3 = Color3.fromRGB(255, 255, 0) -- Default color if no team
                end
                espBoxes[player.UserId] = espBox
            else
                if espBoxes[player.UserId] then
                    espBoxes[player.UserId]:Destroy()
                    espBoxes[player.UserId] = nil
                end
            end
        end
    end
end

-- ESP Button
local espButton = createStyledButton("Toggle ESP", 100)
espButton.MouseButton1Click:Connect(toggleESP)

-- Auto Shoot Button
local shootMurderButton = Instance.new("TextButton")
shootMurderButton.Size = UDim2.new(0, 80, 0, 30)
shootMurderButton.Position = UDim2.new(1, -90, 0, 50) -- Position to the right side
shootMurderButton.Text = "Auto Shoot"
shootMurderButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
shootMurderButton.TextColor3 = Color3.fromRGB(0, 255, 127)
shootMurderButton.Font = Enum.Font.Gotham
shootMurderButton.TextSize = 14
shootMurderButton.Parent = MainFrame

local autoShootEnabled = false

shootMurderButton.MouseButton1Click:Connect(function()
    autoShootEnabled = not autoShootEnabled
    if autoShootEnabled then
        local remote = ReplicatedStorage:FindFirstChild("ShootRemote")
        if not remote then
            warn("ShootRemote not found in ReplicatedStorage.")
            autoShootEnabled = false
            return
        end

        -- Start auto shooting
        while autoShootEnabled do
            wait(0.5)  -- Adjust as needed
            local gun = LocalPlayer.Backpack:FindFirstChild("Gun") or LocalPlayer.Character:FindFirstChild("Gun")
            if gun and remote then
                remote:FireServer() -- Fires the gun
                print("Shooting...")
            else
                print("No gun found in backpack or character.")
            end
        end
    end
end)

-- Ensure ESP is correctly applied on character added
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        if espEnabled then
            toggleESP() -- Reapply ESP
        end
    end)
end)

-- Clean up ESP on player removal
Players.PlayerRemoving:Connect(function(player)
    if espBoxes[player.UserId] then
        espBoxes[player.UserId]:Destroy()
        espBoxes[player.UserId] = nil
    end
end)

-- Initial ESP check for LocalPlayer's character
LocalPlayer.CharacterAdded:Connect(function(character)
    if espEnabled then
        toggleESP() -- Reapply ESP for local player
    end
end)
