-- Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

-- Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "VanxellHub"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Main Frame for Hub
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 400)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -200)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainFrame.BackgroundTransparency = 0.2
MainFrame.BorderSizePixel = 0
MainFrame.Visible = false
MainFrame.Parent = ScreenGui
MainFrame.ClipsDescendants = true

-- Rounded Corners for MainFrame
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = MainFrame

-- Title
local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.Text = "Vanxell Hub"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.Parent = MainFrame

-- Toggle Button
local toggleGuiButton = Instance.new("TextButton")
toggleGuiButton.Size = UDim2.new(0, 80, 0, 30)
toggleGuiButton.Position = UDim2.new(0, 10, 0.5, -15)
toggleGuiButton.Text = "Toggle GUI"
toggleGuiButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleGuiButton.TextColor3 = Color3.fromRGB(0, 255, 127)
toggleGuiButton.Font = Enum.Font.Gotham
toggleGuiButton.TextSize = 14
toggleGuiButton.Parent = ScreenGui

-- Toggle visibility of the main frame
toggleGuiButton.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

-- Function to create styled buttons
local function createStyledButton(text, positionY)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, -20, 0, 35)
    button.Position = UDim2.new(0, 10, 0, positionY)
    button.Text = text
    button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.Gotham
    button.TextSize = 16
    button.Parent = MainFrame

    -- Hover effect
    button.MouseEnter:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    end)
    button.MouseLeave:Connect(function()
        button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    end)

    return button
end

-- Grab Gun Button
local grabGunButton = createStyledButton("Grab Gun", 50)
grabGunButton.MouseButton1Click:Connect(function()
    local gun = Workspace:FindFirstChild("Gun")
    if gun then
        LocalPlayer.Character.HumanoidRootPart.CFrame = gun.Handle.CFrame * CFrame.new(0, 2, 0)
        wait(0.1)
        gun.Parent = LocalPlayer.Backpack
        print("Gun grabbed successfully.")
    else
        print("No gun found.")
    end
end)

-- ESP Button
local espButton = createStyledButton("Toggle ESP", 100)
local espEnabled = false
local espBoxes = {}

espButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    if espEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                local espBox = Instance.new("BoxHandleAdornment")
                espBox.Size = Vector3.new(2, 5, 2)
                espBox.AlwaysOnTop = true
                espBox.ZIndex = 5

                espBox.Parent = player.Character:WaitForChild("HumanoidRootPart")
                espBoxes[player.UserId] = espBox

                if player.Team.Name == "Murderer" then
                    espBox.Color3 = Color3.fromRGB(255, 0, 0) -- Murderer color
                elseif player.Team.Name == "Sheriff" then
                    espBox.Color3 = Color3.fromRGB(0, 0, 255) -- Sheriff color
                elseif player.Team.Name == "Innocents" then
                    espBox.Color3 = Color3.fromRGB(0, 255, 0) -- Innocent color
                end
            end
        end
    else
        for _, espBox in pairs(espBoxes) do
            espBox:Destroy()
        end
        espBoxes = {}
    end
end)

-- Auto Shoot Button
local shootMurderButton = createStyledButton("Shoot Murder", 150)
local autoShootEnabled = false

shootMurderButton.MouseButton1Click:Connect(function()
    autoShootEnabled = not autoShootEnabled
    if autoShootEnabled then
        local autoShootButton = Instance.new("TextButton")
        autoShootButton.Size = UDim2.new(0, 100, 0, 30)
        autoShootButton.Position = UDim2.new(1, -110, 0.5, -15)
        autoShootButton.Text = "Auto Shoot"
        autoShootButton.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
        autoShootButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        autoShootButton.Font = Enum.Font.Gotham
        autoShootButton.TextSize = 14
        autoShootButton.Parent = MainFrame

        autoShootButton.MouseButton1Click:Connect(function()
            autoShootEnabled = false
            autoShootButton:Destroy() -- Remove auto shoot button when clicked
        end)

        -- Auto shooting logic
        while autoShootEnabled do
            wait(0.5)  -- Adjust as needed
            local gun = LocalPlayer.Backpack:FindFirstChild("Gun") or LocalPlayer.Character:FindFirstChild("Gun")
            if gun then
                local remote = ReplicatedStorage:FindFirstChild("ShootRemote") -- Make sure to adjust this
                if remote then
                    remote:FireServer() -- Fires the gun
                end
            end
        end
    end
end)

-- Ensure ESP is correctly applied on character added
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        if espEnabled then
            local espBox = Instance.new("BoxHandleAdornment")
            espBox.Size = Vector3.new(2, 5, 2)
            espBox.AlwaysOnTop = true
            espBox.ZIndex = 5
            espBox.Parent = character:WaitForChild("HumanoidRootPart")
            espBoxes[player.UserId] = espBox
        end
    end)
end)

-- Ensure ESP and auto-shoot functions work on character respawn
LocalPlayer.CharacterAdded:Connect(function(character)
    if espEnabled then
        local espBox = Instance.new("BoxHandleAdornment")
        espBox.Size = Vector3.new(2, 5, 2)
        espBox.AlwaysOnTop = true
        espBox.ZIndex = 5
        espBox.Parent = character:WaitForChild("HumanoidRootPart")
        espBoxes[LocalPlayer.UserId] = espBox
    end
end)

-- Clean up ESP on player removal
Players.PlayerRemoving:Connect(function(player)
    if espBoxes[player.UserId] then
        espBoxes[player.UserId]:Destroy()
        espBoxes[player.UserId] = nil
    end
end)
